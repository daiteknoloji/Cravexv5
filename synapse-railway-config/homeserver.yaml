## Server ##
server_name: "matrix-synapse-production.up.railway.app"
pid_file: /tmp/homeserver.pid
public_baseurl: "https://matrix-synapse-production.up.railway.app/"
web_client_location: "https://vcravex1.netlify.app"
serve_server_wellknown: true

## Ports ##
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']

    resources:
      - names: [client, federation]
        compress: false

# CORS Configuration for Admin Panel
experimental_features:
  msc3886_endpoint: /refresh

# Allow CORS from Netlify domains
# Railway'de reverse proxy var, bu yüzden CORS headers'ı doğru şekilde göndermeliyiz
cors_allowed_origins:
  - "https://vcravex1.netlify.app"
  - "https://cravex-admin.netlify.app"
  - "https://cozy-dragon-54547b.netlify.app"

## Database ##
database:
  name: psycopg2
  txn_limit: 10000
  allow_unsafe_locale: true
  args:
    user: postgres
    password: changeme
    database: railway
    host: localhost
    port: 5432
    cp_min: 5
    cp_max: 10

## Logging ##
# log_config: "/data/log.config"  # Disabled for Railway - permission denied
# Railway'de persistent volume yok, varsayılan log ayarları kullanılacak

## Media Store ##
media_store_path: "/tmp/media_store"
max_upload_size: 50M
max_image_pixels: 32M
dynamic_thumbnails: true

## Captcha ##
enable_registration_captcha: false

## Registration ##
enable_registration: true
enable_registration_without_verification: true
registration_shared_secret: "CHANGE_THIS_TO_RANDOM_STRING"
allow_guest_access: false

## Metrics ##
enable_metrics: false
report_stats: false

## API Configuration ##
# room_invite_state_types removed to avoid deprecated warnings
# room_prejoin_state has complex format, leaving it out for simplicity

app_service_config_files: []

## Signing Keys ##
signing_key_path: "/tmp/signing.key"
trusted_key_servers:
  - server_name: "matrix.org"
suppress_key_server_warning: true

## CORS - Synapse Admin UI için ##
# Bu ayarlar web_client_location ile otomatik ayarlanır
# Ekstra CORS gerekirse burayı düzenleyin

## Redis (opsiyonel) ##
# redis:
#   enabled: false

## Push ##
push:
  include_content: true

## Password ##
password_config:
  enabled: true
  localdb_enabled: true
  pepper: "CHANGE_THIS_PEPPER"
  
## Password reset (disabled - no email configured) ##
enable_password_reset: false

## Email (disabled for Railway) ##
# Email notifications disabled - no SMTP server configured

## Ratelimiting ##
rc_message:
  per_second: 10
  burst_count: 50

rc_registration:
  per_second: 0.17
  burst_count: 3

rc_login:
  address:
    per_second: 0.17
    burst_count: 3
  account:
    per_second: 0.17
    burst_count: 3
  failed_attempts:
    per_second: 0.17
    burst_count: 3

## Federation ##
federation_domain_whitelist: []
federation_metrics_domains: []

## Retention ##
retention:
  enabled: false

## User Directory ##
user_directory:
  enabled: true
  search_all_users: true

## TURN/STUN Server for Video Calls ##
# Metered.ca TURN Server (Öncelikli - kendi credentials'ımızla)
# NOT: Synapse turn_shared_secret ile username/password oluşturuyor
# Bu yüzden Metered.ca credentials'ları config.json'da kalacak
# Synapse sadece TURN server URL'lerini verecek
turn_uris:
  # Metered.ca TURN Server (Öncelikli - YENİ URL'LER)
  - "stun:stun.relay.metered.ca:80"
  - "turn:global.relay.metered.ca:80"
  - "turn:global.relay.metered.ca:80?transport=tcp"
  - "turn:global.relay.metered.ca:443"
  - "turns:global.relay.metered.ca:443?transport=tcp"
  # Matrix.org TURN Server (Fallback)
  - "turn:turn.matrix.org:3478?transport=udp"
  - "turn:turn.matrix.org:3478?transport=tcp"
  - "turns:turn.matrix.org:443?transport=tcp"

turn_shared_secret: "n0t4ctu4lly4n4ctua1s3cr3t4t4ll"
turn_user_lifetime: 86400000
turn_allow_guests: true

